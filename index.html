<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Breeding Genetics Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0a;
      --gold: #b8882a;
      --cream: #ede8dc;
      --divider: rgba(255, 255, 255, 0.15);
      --input-bg: #141414;
      --input-border: #2a2a2a;
      --font-serif: 'Cormorant Garamond', Georgia, serif;
      --font-sans: 'DM Sans', system-ui, sans-serif;
      --transition-speed: 380ms;
    }

    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--cream);
      font-family: var(--font-sans);
      font-size: 16px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem;
    }

    .calculator-wrapper {
      width: 100%;
      max-width: 520px;
    }

    .calculator {
      width: 100%;
    }

    h2.step-title {
      font-family: var(--font-serif);
      font-weight: 500;
      font-size: 1.65rem;
      letter-spacing: 0.01em;
      margin-bottom: 1.75rem;
      color: var(--cream);
    }

    .steps-viewport {
      overflow: hidden;
      position: relative;
    }

    .steps-track {
      display: flex;
      transition: transform var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
    }

    .step {
      min-width: 100%;
      flex-shrink: 0;
      padding: 0.5rem 0;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--divider);
    }

    .btn {
      font-family: var(--font-sans);
      font-size: 0.875rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      padding: 0.7rem 1.8rem;
      transition: opacity 200ms ease, background 200ms ease;
    }

    .btn-back {
      background: transparent;
      color: var(--cream);
      opacity: 0.5;
    }

    .btn-back:hover {
      opacity: 0.8;
    }

    .btn-next {
      background: var(--gold);
      color: var(--bg);
    }

    .btn-next:hover {
      background: #c9963a;
    }

    .btn[disabled] {
      opacity: 0.25;
      cursor: default;
      pointer-events: none;
    }

    /* Step Indicator */
    .step-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2.5rem;
      gap: 0;
    }

    .si-step {
      font-family: var(--font-sans);
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--cream);
      opacity: 0.25;
      transition: opacity 300ms ease, color 300ms ease;
      width: 1.5rem;
      text-align: center;
      flex-shrink: 0;
    }

    .si-step.active {
      opacity: 1;
      color: var(--gold);
    }

    .si-step.completed {
      opacity: 0.5;
    }

    .si-line {
      height: 1px;
      width: 3rem;
      background: var(--cream);
      opacity: 0.15;
      flex-shrink: 0;
    }

    /* Form Fields */
    .field {
      margin-bottom: 1.25rem;
    }

    .field-label {
      display: block;
      font-family: var(--font-sans);
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--cream);
      opacity: 0.6;
      margin-bottom: 0.5rem;
    }

    .field-input {
      width: 100%;
      padding: 0.75rem 0.875rem;
      font-family: var(--font-sans);
      font-size: 0.9375rem;
      color: var(--cream);
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: 0;
      outline: none;
      transition: border-color 200ms ease, box-shadow 200ms ease;
      -webkit-appearance: none;
      appearance: none;
    }

    .field-input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 1px rgba(184, 136, 42, 0.25);
    }

    select.field-input {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='7' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23ede8dc' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.875rem center;
      padding-right: 2.5rem;
      cursor: pointer;
    }

    select.field-input option {
      background: var(--input-bg);
      color: var(--cream);
    }

    .optional-tag {
      font-size: 0.65rem;
      font-weight: 400;
      text-transform: none;
      letter-spacing: 0.02em;
      opacity: 0.4;
      margin-left: 0.35rem;
    }

    input[type="date"].field-input {
      color-scheme: dark;
    }

    input[type="number"].field-input::-webkit-inner-spin-button,
    input[type="number"].field-input::-webkit-outer-spin-button {
      opacity: 0.3;
    }

    input::placeholder {
      color: var(--cream);
      opacity: 0.2;
    }

    /* Results Section */
    .results-section {
      margin-bottom: 2rem;
    }

    .section-header {
      font-family: var(--font-serif);
      font-weight: 500;
      font-size: 1.15rem;
      color: var(--cream);
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--divider);
    }

    .result-group {
      margin-bottom: 1.5rem;
    }

    .result-subhead {
      font-family: var(--font-sans);
      font-size: 0.7rem;
      font-weight: 500;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--cream);
      opacity: 0.45;
      margin-bottom: 0.75rem;
    }

    /* DM Bar */
    .dm-bar {
      display: flex;
      height: 2rem;
      width: 100%;
      overflow: hidden;
    }

    .dm-segment {
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-sans);
      font-size: 0.7rem;
      font-weight: 500;
      color: var(--bg);
      transition: width 400ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dm-clear { background: #5a8a5a; }
    .dm-carrier { background: #c9963a; }
    .dm-affected { background: #8b4a4a; }

    /* Swatches */
    .swatch-row {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .swatch {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .swatch-color {
      width: 3.5rem;
      height: 3.5rem;
    }

    .swatch-label {
      font-family: var(--font-sans);
      font-size: 0.65rem;
      font-weight: 500;
      color: var(--cream);
      opacity: 0.7;
      text-align: center;
      max-width: 4.5rem;
    }

    .swatch-pct {
      font-family: var(--font-sans);
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--cream);
      text-align: center;
    }

    /* Calendar Strip */
    .calendar-strip {
      display: flex;
      gap: 0.375rem;
      justify-content: center;
    }

    .cal-day {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.35rem;
    }

    .cal-day-num {
      width: 2.75rem;
      height: 2.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-sans);
      font-size: 0.85rem;
      font-weight: 500;
      border: 1px solid var(--input-border);
      transition: background 300ms ease, border-color 300ms ease;
    }

    .cal-day-label {
      font-family: var(--font-sans);
      font-size: 0.6rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      opacity: 0.4;
    }

    .cal-day.peak .cal-day-num {
      background: var(--gold);
      border-color: var(--gold);
      color: var(--bg);
    }

    .cal-day.near .cal-day-num {
      background: rgba(184, 136, 42, 0.5);
      border-color: rgba(184, 136, 42, 0.5);
      color: var(--cream);
    }

    .cal-day.far .cal-day-num {
      background: rgba(184, 136, 42, 0.2);
      border-color: rgba(184, 136, 42, 0.25);
      color: var(--cream);
    }

    .prog-note {
      font-family: var(--font-sans);
      font-size: 0.75rem;
      color: var(--cream);
      opacity: 0.4;
      margin-top: 1rem;
      text-align: center;
    }

    .prog-note:empty {
      display: none;
    }
  </style>
</head>
<body>
  <div class="calculator-wrapper">
    <div class="calculator">

      <!-- Step Indicator -->
      <div class="step-indicator" id="stepIndicator">
        <span class="si-step active" data-step="0">1</span>
        <span class="si-line"></span>
        <span class="si-step" data-step="1">2</span>
        <span class="si-line"></span>
        <span class="si-step" data-step="2">3</span>
      </div>

      <!-- Steps Container -->
      <div class="steps-viewport">
        <div class="steps-track" id="stepsTrack">

          <!-- Step 1: About Your Female -->
          <div class="step" id="step1">
            <h2 class="step-title">About Your Female</h2>
            <div class="step-content">
              <div class="field">
                <label class="field-label" for="dmStatus">DM Status</label>
                <select class="field-input" id="dmStatus">
                  <option value="" disabled selected>Select</option>
                  <option value="N/N">N/N</option>
                  <option value="N/DM">N/DM</option>
                  <option value="DM/DM">DM/DM</option>
                </select>
              </div>
              <div class="field">
                <label class="field-label" for="coatLength">Coat Length</label>
                <select class="field-input" id="coatLength">
                  <option value="" disabled selected>Select</option>
                  <option value="LL">Short / Non-Carrier</option>
                  <option value="Ll">Short / Carries Long</option>
                  <option value="ll">Long Coat</option>
                </select>
              </div>
              <div class="field">
                <label class="field-label" for="baseColor">Base Color</label>
                <select class="field-input" id="baseColor">
                  <option value="" disabled selected>Select</option>
                  <option value="sable">Sable</option>
                  <option value="black_tan">Black &amp; Tan</option>
                  <option value="black_red">Black &amp; Red</option>
                  <option value="bicolor">Bicolor</option>
                  <option value="solid_black">Solid Black</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Step 2: Heat Cycle -->
          <div class="step" id="step2">
            <h2 class="step-title">Heat Cycle</h2>
            <div class="step-content">
              <div class="field">
                <label class="field-label" for="heatDate">First Day of Visible Heat</label>
                <input type="date" class="field-input" id="heatDate">
              </div>
              <div class="field">
                <label class="field-label" for="progesterone">Progesterone (ng/mL) <span class="optional-tag">Optional</span></label>
                <input type="number" class="field-input" id="progesterone" placeholder="e.g. 5.0" step="0.1" min="0">
              </div>
            </div>
          </div>

          <!-- Step 3: Results -->
          <div class="step" id="step3">
            <h2 class="step-title">Results</h2>
            <div class="step-content">

              <!-- Genetics Results -->
              <div class="results-section" id="geneticsResults">
                <h3 class="section-header">Genetics</h3>

                <div class="result-group fade-item">
                  <h4 class="result-subhead">DM Status</h4>
                  <div class="dm-bar" id="dmBar"></div>
                </div>

                <div class="result-group fade-item">
                  <h4 class="result-subhead">Coat Length</h4>
                  <div class="swatch-row" id="coatSwatches"></div>
                </div>

                <div class="result-group fade-item">
                  <h4 class="result-subhead">Color Outcomes</h4>
                  <div class="swatch-row" id="colorSwatches"></div>
                </div>
              </div>

              <!-- Breeding Window -->
              <div class="results-section fade-item" id="breedingWindow">
                <h3 class="section-header">Breeding Window</h3>
                <div class="calendar-strip" id="calendarStrip"></div>
                <p class="prog-note" id="progNote"></p>
              </div>

            </div>
          </div>

        </div>
      </div>

      <!-- Navigation -->
      <div class="nav-buttons">
        <button class="btn btn-back" id="btnBack">Back</button>
        <button class="btn btn-next" id="btnNext">Next</button>
      </div>

    </div>
  </div>

  <script>
    (function() {
      'use strict';

      const TOTAL_STEPS = 3;
      let currentStep = 0;

      const track = document.getElementById('stepsTrack');
      const btnBack = document.getElementById('btnBack');
      const btnNext = document.getElementById('btnNext');
      const siSteps = document.querySelectorAll('.si-step');

      // === Sagi's Genetics (hardcoded) ===
      // DM: N/N, Coat: l/l (short non-carrier), Color: Ay/a (sable carrier of recessive black)
      var SIRE = { dm: 'N/N', coat: 'LL', colorAlleles: ['Ay', 'a'] };

      // === Genetics Calculations ===
      function calcDM(damDM) {
        // Sire is N/N — always contributes N
        // Dam: N/N → 100% clear, N/DM → 50% clear 50% carrier, DM/DM → 100% carrier
        if (damDM === 'N/N')  return { clear: 100, carrier: 0, affected: 0 };
        if (damDM === 'N/DM') return { clear: 50, carrier: 50, affected: 0 };
        if (damDM === 'DM/DM') return { clear: 0, carrier: 100, affected: 0 };
        return { clear: 0, carrier: 0, affected: 0 };
      }

      function calcCoat(damCoat) {
        // Sire is LL (short, non-carrier of long = L/L)
        // l = long allele, L = short allele
        // Sire L/L x Dam L/L → 100% LL (short)
        // Sire L/L x Dam L/l → 50% LL, 50% Ll (all short)
        // Sire L/L x Dam l/l → 100% Ll (all short, all carriers)
        if (damCoat === 'LL') return [{ type: 'Short', pct: 100 }];
        if (damCoat === 'Ll') return [{ type: 'Short', pct: 50 }, { type: 'Short (Carries Long)', pct: 50 }];
        if (damCoat === 'll') return [{ type: 'Short (Carries Long)', pct: 100 }];
        return [];
      }

      function calcColor(damColor) {
        // Sire: Ay/a (Sable, carries recessive black)
        // Ay = sable (dominant), at = tan point, a = recessive black
        // Black & Tan / Black & Red = at/at or at/a
        // Bicolor = at/at (extreme tan point expression) — genetically same as B&T
        // Solid Black = a/a
        // Sable = Ay/Ay or Ay/at or Ay/a

        var sireA = SIRE.colorAlleles; // ['Ay', 'a']
        var damA;

        if (damColor === 'sable') {
          // Assume Ay/a (most common in working lines)
          damA = ['Ay', 'a'];
        } else if (damColor === 'black_tan' || damColor === 'black_red') {
          // at/at (standard tan point)
          damA = ['at', 'at'];
        } else if (damColor === 'bicolor') {
          // at/at (bicolor is extreme expression of tan point)
          damA = ['at', 'at'];
        } else if (damColor === 'solid_black') {
          // a/a
          damA = ['a', 'a'];
        } else {
          return [];
        }

        // Cross: each sire allele x each dam allele
        var combos = {};
        for (var i = 0; i < sireA.length; i++) {
          for (var j = 0; j < damA.length; j++) {
            var pair = [sireA[i], damA[j]].sort(alleleSort);
            var key = pair.join('/');
            combos[key] = (combos[key] || 0) + 1;
          }
        }

        var total = sireA.length * damA.length;
        var results = [];
        for (var k in combos) {
          results.push({ genotype: k, pct: Math.round((combos[k] / total) * 100), phenotype: phenotypeFromGenotype(k) });
        }
        return results;
      }

      function alleleSort(a, b) {
        var order = { 'Ay': 0, 'at': 1, 'a': 2 };
        return (order[a] || 99) - (order[b] || 99);
      }

      function phenotypeFromGenotype(g) {
        if (g.indexOf('Ay') !== -1) return 'Sable';
        if (g === 'at/at' || g === 'at/a') return 'Black & Tan';
        if (g === 'a/a') return 'Solid Black';
        return 'Unknown';
      }

      // Color swatch hex values for GSD coat colors
      var COAT_COLORS = {
        'Sable':       '#8B7355',
        'Black & Tan': '#2E1A0E',
        'Solid Black': '#0f0f0f',
        'Unknown':     '#333333'
      };

      var COAT_LENGTH_COLORS = {
        'Short':                '#6B5B3E',
        'Short (Carries Long)': '#7A6644',
        'Long':                 '#8B7355'
      };

      // === Breeding Window Calculation ===
      function calcBreedingWindow(heatDateStr, progesterone) {
        var heatDate = new Date(heatDateStr + 'T00:00:00');
        var baseOffset = 11; // Day 11-12 from first visible heat is typical peak
        var note = '';

        if (progesterone && progesterone > 0) {
          // Progesterone-based refinement
          // < 2 ng/mL: pre-ovulation, breeding in ~4-6 days
          // 2-5 ng/mL: near ovulation, breeding in ~2-3 days
          // 5-8 ng/mL: ovulation occurring, breed within 1-2 days
          // > 8 ng/mL: post-ovulation, breed immediately or within 1 day
          if (progesterone < 2) {
            baseOffset = 14;
            note = 'Window adjusted for pre-ovulatory progesterone reading.';
          } else if (progesterone <= 5) {
            baseOffset = 12;
            note = 'Window refined based on near-ovulation progesterone level.';
          } else if (progesterone <= 8) {
            baseOffset = 10;
            note = 'Window adjusted for active ovulation progesterone level.';
          } else {
            baseOffset = 9;
            note = 'Window adjusted for post-ovulatory progesterone reading.';
          }
        }

        // Build 5-day window centered on peak
        var days = [];
        var DAY_NAMES = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        for (var i = -2; i <= 2; i++) {
          var d = new Date(heatDate);
          d.setDate(d.getDate() + baseOffset + i);
          var intensity;
          if (i === 0) intensity = 'peak';
          else if (Math.abs(i) === 1) intensity = 'near';
          else intensity = 'far';
          days.push({
            date: d,
            dayNum: d.getDate(),
            dayName: DAY_NAMES[d.getDay()],
            intensity: intensity
          });
        }

        return { days: days, note: note };
      }

      function goToStep(step) {
        if (step < 0 || step >= TOTAL_STEPS) return;
        currentStep = step;
        track.style.transform = 'translateX(-' + (currentStep * 100) + '%)';
        updateIndicator();
        updateButtons();
        if (currentStep === 2) {
          renderResults();
        }
      }

      function updateIndicator() {
        siSteps.forEach(function(el) {
          var s = parseInt(el.dataset.step, 10);
          el.classList.remove('active', 'completed');
          if (s === currentStep) el.classList.add('active');
          else if (s < currentStep) el.classList.add('completed');
        });
      }

      function updateButtons() {
        btnBack.disabled = currentStep === 0;
        if (currentStep === TOTAL_STEPS - 1) {
          btnNext.style.display = 'none';
        } else {
          btnNext.style.display = '';
          btnNext.textContent = 'Next';
        }
      }

      function validateStep(step) {
        if (step === 0) {
          return document.getElementById('dmStatus').value &&
                 document.getElementById('coatLength').value &&
                 document.getElementById('baseColor').value;
        }
        if (step === 1) {
          return document.getElementById('heatDate').value;
        }
        return true;
      }

      btnNext.addEventListener('click', function() {
        if (!validateStep(currentStep)) return;
        goToStep(currentStep + 1);
      });

      btnBack.addEventListener('click', function() {
        goToStep(currentStep - 1);
      });

      function renderResults() {
        var damDM = document.getElementById('dmStatus').value;
        var damCoat = document.getElementById('coatLength').value;
        var damColor = document.getElementById('baseColor').value;
        var heatDate = document.getElementById('heatDate').value;
        var prog = parseFloat(document.getElementById('progesterone').value) || 0;

        // --- DM Bar ---
        var dm = calcDM(damDM);
        var dmBar = document.getElementById('dmBar');
        dmBar.innerHTML = '';
        if (dm.clear > 0) {
          var seg = document.createElement('div');
          seg.className = 'dm-segment dm-clear';
          seg.style.width = dm.clear + '%';
          seg.textContent = 'Clear ' + dm.clear + '%';
          dmBar.appendChild(seg);
        }
        if (dm.carrier > 0) {
          var seg2 = document.createElement('div');
          seg2.className = 'dm-segment dm-carrier';
          seg2.style.width = dm.carrier + '%';
          seg2.textContent = 'Carrier ' + dm.carrier + '%';
          dmBar.appendChild(seg2);
        }
        if (dm.affected > 0) {
          var seg3 = document.createElement('div');
          seg3.className = 'dm-segment dm-affected';
          seg3.style.width = dm.affected + '%';
          seg3.textContent = 'Affected ' + dm.affected + '%';
          dmBar.appendChild(seg3);
        }

        // --- Coat Swatches ---
        var coatResults = calcCoat(damCoat);
        var coatContainer = document.getElementById('coatSwatches');
        coatContainer.innerHTML = '';
        coatResults.forEach(function(item) {
          var swatch = document.createElement('div');
          swatch.className = 'swatch fade-item';
          var colorDiv = document.createElement('div');
          colorDiv.className = 'swatch-color';
          colorDiv.style.background = COAT_LENGTH_COLORS[item.type] || '#555';
          var labelDiv = document.createElement('div');
          labelDiv.className = 'swatch-label';
          labelDiv.textContent = item.type;
          var pctDiv = document.createElement('div');
          pctDiv.className = 'swatch-pct';
          pctDiv.textContent = item.pct + '%';
          swatch.appendChild(colorDiv);
          swatch.appendChild(labelDiv);
          swatch.appendChild(pctDiv);
          coatContainer.appendChild(swatch);
        });

        // --- Color Swatches ---
        var colorResults = calcColor(damColor);
        var colorContainer = document.getElementById('colorSwatches');
        colorContainer.innerHTML = '';
        colorResults.forEach(function(item) {
          var swatch = document.createElement('div');
          swatch.className = 'swatch fade-item';
          var colorDiv = document.createElement('div');
          colorDiv.className = 'swatch-color';
          colorDiv.style.background = COAT_COLORS[item.phenotype] || '#555';
          var labelDiv = document.createElement('div');
          labelDiv.className = 'swatch-label';
          labelDiv.textContent = item.phenotype;
          var pctDiv = document.createElement('div');
          pctDiv.className = 'swatch-pct';
          pctDiv.textContent = item.pct + '%';
          swatch.appendChild(colorDiv);
          swatch.appendChild(labelDiv);
          swatch.appendChild(pctDiv);
          colorContainer.appendChild(swatch);
        });

        // --- Breeding Window ---
        var bw = calcBreedingWindow(heatDate, prog);
        var strip = document.getElementById('calendarStrip');
        strip.innerHTML = '';
        bw.days.forEach(function(day) {
          var cell = document.createElement('div');
          cell.className = 'cal-day ' + day.intensity + ' fade-item';
          var numDiv = document.createElement('div');
          numDiv.className = 'cal-day-num';
          numDiv.textContent = day.dayNum;
          var labelDiv = document.createElement('div');
          labelDiv.className = 'cal-day-label';
          labelDiv.textContent = day.dayName;
          cell.appendChild(numDiv);
          cell.appendChild(labelDiv);
          strip.appendChild(cell);
        });

        var noteEl = document.getElementById('progNote');
        noteEl.textContent = bw.note;
      }

      // Initialize
      updateButtons();
    })();
  </script>
</body>
</html>
